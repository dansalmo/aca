<!doctype html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>Comment Box</title>
  <meta name="author" content="Dan Salmonsen">
  <link rel="stylesheet" type="text/css" media="all" href="static/css/comment.css">
  <link rel="stylesheet" type="text/css" media="all" href="static/fancybox/jquery.fancybox.css">
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <script type="text/javascript" src="static/fancybox/jquery.fancybox.js?v=2.0.6"></script>
</head>

<body>
<div id="wrapper1">
	<p><a href="#fancy-form" data-article-id="1" data-user="Dan" data-title="Title1" class="fancy-comment">add comment</a></p>
	<p><a href="#fancy-form" data-article-id="2" data-user="Dan" data-title="Title2" class="fancy-comment">add comment</a></p>
</div>

<!-- hidden comment form -->
<div id="fancy-form" style="display: none; width: 600px;" >
	<form id="comment-form" name="comment-form" action="#" method="post">
		<label for="user">By: User</label>
		<br />
		<br />
		<label for="comment-text">Enter a comment</label>
		<textarea id="comment-text" name="comment-text" class="txtarea"></textarea>
		
		<button class="publish" id="publish-it">Publish comment</button>
	</form>
</div>

<!-- multi-fancybox setup -->
<script type="text/javascript">
	$(document).ready(function() {
    $(".fancy-comment").fancybox({
        afterLoad: function() {
            var id = $(this.element).data('article-id');
            var user = $(this.element).data('user');
            var title = $(this.element).data('title');
            this.inner.prepend('<h2>Comment on: ' + title + '</h2>');
            $("form", this.content).attr("name", "comment-form-" + id);
            $("label:first", this.content).text("By: " + user);
            $("textarea", this.content).attr("name", "comment-text-" + id);
            $('#comment-text').removeClass("error");
        }
    });
    $("#comment-form").submit(function() { return false; });
    $('#publish-it').on("click", function(){
      var msgval    = $('#comment-text').val();
      var msglen    = msgval.length;
      
      if(msglen < 10) {
        $('#comment-text').addClass("error");
      }
      else if(msglen >= 10){
        $('#comment-text').removeClass("error");
      }
      
      if(msglen >= 10) {
        // hide the btn so the user can't click again
        $('#publish-it').replaceWith("<em>publishing...</em>");
        
        $.ajax({
          type: 'POST',
          url: 'sendmessage.php',
          data: $('#comment-form').serialize(),
          success: function(data) {
            if(data == "true") {
              $('#comment-form').fadeOut("fast", function(){
                $(this).before("<p><strong>Your comment has been posted.</strong></p>");
                setTimeout("$.fancybox.close()", 1000);
              });
            }
          }
        });
      }
    });
  });
</script>

</body>
</html>